# 本プロジェクトの概要
このプロジェクトはデスクトップアプリ「AIKATA」をwebアプリに移行するためのプロジェクトである。
デスクトップ版では、主にAIチャット機能、AIレビュー機能を提供していた。
web版においてはAIレビュー機能にフォーカスし、より洗練されたAIレビュープラットフォームとして、UI・UXを洗練させる。
また、AIのレビューワークフローなど内部処理については大まかな処理方針は変更しないが、リファクタリングする余地がある部分については積極的に実施する。

# web版AIKATAに関するエレベータピッチ
AIの登場により、チェック・レビュー領域も効率化が進んでいる。
しかし現状はChatGPTのようなチャット型アプリにて、対象と観点を与え、チャットの応答としてレビューの結果を得る方式がメインである。
そこで本プロジェクトでは様々なチェック対象（ドキュメント、プログラム、...）を簡単に・効率的にレビューすることができるAIレビュー専用のプラットフォームを構築する。
アプリの名称はAIKATAとする

# 用語集
@docs/domain/glossary.md

# 要件定義
必要に応じて以下参照（後述のPBIで詳細化しているかつ画面モックに反映済みなので基本的には参照の必要はないが、要件の全体感を確認したい場合は参照すること）
`docs/requirements/index.md`

# 画面モック
要件定義を元に初期版を作成済み。
画面モックにて既に大まかな認識・構想を固めているので適宜参照すること。
`docs/design_mock`

# アプリの開発方針
- TDD
- DDD
  - クリーンアーキテクチャを採用

# 外部設計
## ユビキタス用語集
### エンティティ
`docs/domain/entity.md`
### ビジネスルール
`docs/domain/business_rule.md`
### ユースケース
`docs/domain/usecase.md`

## 環境変数設計
`docs/config/env_val.md`

# 内部設計
## アーキテクチャ設計
@docs/archtecture/tech.md
@docs/archtecture/folder_structure.md

## データ設計
データベース定義は以下ファイルに記載
記載ルールは以下
- 最新のデータベース定義を常に反映させること
- それぞれのテーブルについてカラムレベルで設計思想や意図を記載すること
`docs/db/schema.md`

# アプリ開発の進め方
  1-1. 設計書の修正
   - 対象: `docs`
  1-2. 振る舞いを確認するための（ブラックボックス）テストを作成
    - 古典派的スタイルで作成
    - 正常系、異常系どちらも作成
    - バックエンドロジック、コンポーネントテストどちらも作成
      - バックエンドロジックはアプリケーション層、ドメイン層どちらの振る舞いテストも作成
        - インフラ層については、テスト実施ごとに環境を汚染（環境を隔離して使い捨てができる、またはそのように振る舞わせることができる）しない場合はできる限り作成するが、汚染する場合は不要
          - DBアクセスについてはDrizzleのモックを活用
    - vitestを利用
  2. 1のテストがグリーンになるように実装
  3. リファクタリングとホワイトボックステストを拡充
    - 最終的にテストの条件カバレッジが80%以上となるようにすること

# PBI
@PBI.md

# 作業時の注意点
- クリーンアーキテクチャの中心部分から外側に向けてコーディングを進めること
- Mastraについては実装する際はまずMCPでドキュメントや実装例を参考にしてから正確な情報やベストプラクティスに基づいてコーディングすること
- プロジェクト全体を把握して、全ての実装が必要箇所を正しく洗い出してから実装すること
- 既存資源（型、コンポーネント、ヘルパー関数など）を積極的に活用して効率的に実装すること
- 似たような実装内容がある場合は参考にしたり、共通化を検討すること
- UIは実際に市場に投入できるくらいレベルの高いUIにすること
  - 画面はビジネスライクでプロフェッショナルな印象を与え、全ての画面でスタイル一貫性を保つこと
- 基本コンポーネントについてはshadcn/uiを利用できるのであればそうすること
  - 車輪の再発明を避け、ベストプラクティスに則ることができるため
- TypeScriptを利用して型安全なコードにすること
- プロンプトは英語で記載すること
  - プロンプトの内容は経験豊富なプロンプトエンジニアとしてベストプラクティスに基づいて実装すること
  - 一般的で自然な英語表現にすること
- コードのコメントは日本語で記載すること
- エラーメッセージは全て`messages/ja/template.ts`に集約し、日本語で記載すること
- eslintについては単純なフォーマットエラーの場合は対応する必要はない
- 最終的にtypescriptの型エラーがないことを確認すること
  - 既存のエラーは対応不要
  - 新規実装した部分にエラーがある場合は対応すること
- 最終的にアプリのビルドエラーやアクセス時エラーがないことを確認すること
- URLについてもベストプラクティスに沿って設計すること
  - ブックマーカブルなアプリケーションになるように意識すること
- サーバ処理やフロント側処理の際のエラー時の表示についても考慮すること
  - エラーが起こっているのに、ユーザはそれを感知できないということはないようにする
  - サーバからのレスポンスにエラーメッセージが含まれていた場合（空かどうかバリデーションは必要、空の場合は汎用的なエラーメッセージを表示する）、それはユーザに通知すべきエラーメッセージであるはずなので、表示すること
- 一覧データ等の初回データ取得はRSCで実施できないか検討すること
- ロガーは`next-server/lib/server/logger.ts`の`getLogger`を利用すること
  - 認証済みユーザIDとリクエストIDを含んだロガーを取得可能
- mastra workflowのテストも忘れずに実装すること
  - テスト作成方法はelectron版が参考になる
- 本アプリは最終的に外部ネットワークに繋がらない社内環境でデプロイするため、CDNなどの利用はしないこと
- useActionの使用パターン
  - useActionから返される`isExecuting`（または`isPending`）を必ず取得して使用すること
  - 同じアクションに対してuseState()で別途状態管理をしないこと
  - ボタンのdisabled、条件分岐、ローディング表示に活用すること
  - 複数のアクションを持つコンポーネントでは、それぞれに異なる名前（isSaving, isDeleting等）をaliasすること
  - アクション実行前に前処理（ファイル変換等）が必要な場合は、その前処理用の状態フラグを別途管理し、UI用フラグは`isProcessing = isPreProcessing || isExecuting`のように統合すること
- テストは必ず`npm test`コマンドで実行すること
- このシステムはまだリリースされていないので、コードを変更する際、後方互換製を考慮する必要はない

# 移行時の注意点
- デスクトップ版はドキュメントのレビューを前提にテーブル、型、変数など設計しているが、web版ではドキュメント含めた様々なレビュー対象を想定しているためそのままの名前で移行しないように注意
- デスクトップ版はDDDではなくトランザクションスクリプト形式のアーキテクチャなので注意
- web版はかなりuiを刷新しているので適宜画面モックを確認すること
- electorn版アプリについては`electron-ver`ディレクトリに格納しているため、移行する際は参照すること
  - electron版のアーキテクチャや機能の構成については必要に応じて`electron-ver/README.md`を参照すること